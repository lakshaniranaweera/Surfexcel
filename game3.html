<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Game 3 - Laundry Catch</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Gill Sans MT';
    }

    body {
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      font-family: 'Gill Sans MT';
      /* Game screen background image */
      background:url("New folder (8)/Game Empty.png");
      color: #fff;
      position: relative;
    }

    .game-wrapper {
      position: relative;
      width: 100vw;
      height: 100vh;
      max-width: 1080px;
      max-height: 1920px;
      margin: 0 auto;
      overflow: hidden;
      aspect-ratio: 9 / 16;
    }

    .hud {
      position: absolute;
      top: 140px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 30px;
      font-family: Impact;
      padding: 14px 24px;
      border-radius: 25px;
      
      /* backdrop-filter: blur(6px); */
      z-index: 10;
      font-size: 7.6rem;
    }

    .hud span.label {
      color: rgb(22, 56, 104);
      margin-right: 4px;
    }

    .hud span.value {
      font-weight: 700;
      color: rgb(22, 56, 104);
    }

    .falling-area {
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
      bottom: 120px; /* leave room for washer */
      overflow: hidden;
    }

    .cloth {
      position: absolute;
      width: 200px;
      height: 200px;
      pointer-events: none;
      will-change: transform;
    }

    .cloth img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
.washer {
  position: absolute;
  bottom: 25px;
  left: 50%;
  transform: translateX(-50%);
  width: 640px;   
  height: 640px;
  touch-action: none;
  cursor: grab;
  z-index: 5;
}

    .washer img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      filter: drop-shadow(0 0 18px rgba(0, 0, 0, 0.7));
    }
.washer-counter {
  position: absolute;
  inset: 0;
   bottom: -70px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  font-size: 6.6rem;
  font-weight: bold;
  color: rgb(22, 56, 104);
  /* text-shadow: 0 0 12px rgba(0,0,0,0.9); */
  pointer-events: none;
}
    .hint {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1.4rem;
      color: rgb(22, 56, 104);
      padding-bottom: 8px;
      text-align: center;
    }

    /* Start / Game Over overlays */
    .overlay {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      z-index: 20;
    }

    /* Match Game 2 overlay layout for game over */
    #gameOverOverlay {
      justify-content: flex-start;
    }

    #gameOverOverlay .overlay-content {
      text-align: center;
      padding: 20px 20px 10px;
      margin: 0 auto;
      max-width: 720px;
      width: 100%;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
    }

    
    /* Start overlay specific background image + color */
      #startOverlay,
      #gameOverOverlay {
        background-color: rgb(22, 56, 104);
        background-image: url("New folder (8)/new.png");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        
      }

      /* Glassmorphic popup for overlays */
      #startOverlay .glass-popup,
      #gameOverOverlay .glass-popup {
        position: absolute;
        top: 35%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 900px;
        height: 1200px;
        background: rgba(30, 30, 40, 0.55);
        border-radius: 48px;
        box-shadow: 0 8px 40px rgba(0,0,0,0.35);
        backdrop-filter: blur(18px) saturate(140%);
        border: 2px solid rgba(255,255,255,0.18);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 20;
      }
        /* Glassmorphic popup for startOverlay */
        #startOverlay .glass-popup {
          position: absolute;
          top: 36%;
          left: 50%;
          transform: translate(-50%, -50%);
          width: 900px;
          height: 1150px;
          background: rgba(30, 30, 40, 0.55);
          border-radius: 48px;
          box-shadow: 0 8px 40px rgba(0,0,0,0.35);
          backdrop-filter: blur(18px) saturate(140%);
          border: 2px solid rgba(255,255,255,0.18);
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          z-index: 20;
        
        }

    /* Match Game 1 instruction placement: top & middle for Game 3 intro */
    #startOverlay {
      justify-content: flex-start; /* top vertically (column main axis) */
      align-items: center;        /* center horizontally */
      padding-top: 250px;
    }

    .overlay.hidden {
      display: none;
    }

    .overlay h1 {
      font-size: 5rem;
      margin-bottom: 120px;
      letter-spacing: 2px;
     
    }

    .overlay p {
      max-width: 900px;
      margin-bottom: 20px;
      color: #ffffff;
      font-size: 3.2rem;
      line-height: 1.3;
       font-family: avantgarde-demi;
    }

    .overlay .score-summary {
      margin: 15px 0 25px;
      font-size: 1.8rem;
      color: #4ecdc4;
    }

    .btn {
      padding: 23px 70px;
      font-size: 3.5rem;
      border-radius: 50px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      letter-spacing: 1px;
      text-transform: uppercase;
      margin-top: 48px;
      background: linear-gradient(135deg, #FFFFFF);
      color: rgb(22, 56, 104);
      
      box-shadow: 0 4px 18px rgba(34, 139, 87, 0.6);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(34, 139, 87, 0.8);
    }

    /* Start button style similar to Game 1 instructions */
    #startOverlay .btn {
    font-weight: bold;
            font-size: 3.5rem;
            color: rgb(22, 56, 104);
            padding: 10px 50px;
            border-radius: 50px;
            text-transform: uppercase;
            /* Green Start Game button gradient */
            background: linear-gradient(135deg,  #ffffff);
            font-family: "Gill Sans MT";
            margin-bottom: 110px;
            align-self: center;
    }

    /* Make Game 3 final result button slightly smaller and lower */
    #gameOverOverlay .btn {
      font-size: 3.5rem;
      padding: 30px 70px;
      margin-top: 280px;
      
    }

    /* Center the final result button in the middle of the screen */
    #gameOverOverlay .final-result-btn {
      position: static;
      margin-top: 32px;
      align-self: center;
      margin-top: 0;
    }

    /* 3-box Results UI */
    .result-boxes {
       display: flex;
            flex-direction: column;
            gap: 94px;
            width: 100%;
            max-width: 720px;
            margin: 0 auto 10px;
            height: 500px;
    }

    .result-box {
       border: 4px solid #333;
            border-radius: 66px;
            padding: 20px 30px;
            text-align: center;
            font-size: 5rem;
            color: #888;
            background: rgba(0,0,0,0.3);
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
    }
    .result-box-inner {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      width: 100%;
    }
    
    .result-box.current {
      border: 4px dashed #4ecdc4;
      background: rgba(78, 205, 196, 0.1);
      color: #fff;
    }

    .result-box.completed {
      border: 4px solid #555;
      
    }

    .result-box.win {
      border-color: #00ff88;
      background: rgba(0, 255, 136, 0.15);
      color: #fff;
      
    }

    .result-box.fail {
      border-color: #ff4444;
      background: rgba(255, 68, 68, 0.15);
      color: #fff;
      
    }

    .result-box .game-label {
      font-size: 3.4rem;
      color: #aaa;
      margin-bottom: 0;
      display: inline-block;
      vertical-align: middle;
      font-family: 'Gill Sans MT';
    }

    .result-box .game-status {
      font-size: 4.4rem;
      font-weight: bold;
      display: inline-block;
      vertical-align: middle;
      font-family: 'Gill Sans MT';
    }

    /* Intro / result video sizing for Game 3 - fullscreen inside overlay */
    #videoOverlay video,
    #resultVideoOverlay video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  </style>
</head>
<body>
  <div class="game-wrapper">
    <div class="hud">
      <div><span class="label"></span> <span id="timeValue" class="value">30</span></div>
      <!-- <div><span class="label">Caught:</span> <span id="scoreValue" class="value">0</span></div> -->
      <!-- <div><span class="label">Missed:</span> <span id="missValue" class="value">0</span></div> -->
    </div>

    <div class="falling-area" id="fallingArea"></div>

    <div class="washer" id="washer">
  <img src="images/washingmachine.png" alt="Washing Machine" />

  <div class="washer-counter">
    <!-- <div id="washerTime">30</div> -->
    <div id="washerScore">0</div>
  </div>
</div>


    <!-- <div class="hint">Use ◀ ▶ keys or drag the washing machine to catch the falling clothes.</div> -->

    <!-- Start overlay -->
    <div class="overlay" id="startOverlay">
        <div class="glass-popup">
          <h1>HOW TO PLAY</h1>
          <p class="justify-text">1.Catch the stained clothes that fall <br>from the top</p><br><br><br><br>
          <p>2.Move the washing machine either to the left or right to catch as many clothes as you can before time runs out</p>
          <br><br><button class="btn" id="startBtn">Start GAME</button>
        </div>
    </div>

    <!-- Game 3 Intro Video Overlay -->
    <div class="overlay hidden" id="videoOverlay">
      <video id="game3IntroVideo" playsinline webkit-playsinline>
        <source src="videos/03_game_pop.mp4" type="video/mp4" />
      </video>
    </div>

    <!-- Game 3 Result Video Overlay (Win/Fail) -->
    <div class="overlay hidden" id="resultVideoOverlay">
      <video id="game3ResultVideo" playsinline webkit-playsinline></video>
    </div>

    <!-- Game over overlay -->
    <div class="overlay hidden" id="gameOverOverlay">
      <div class="glass-popup">
        <div class="overlay-content">
          <h1>GAME RESULTS</h1>
          <div class="result-boxes">
            <div class="result-box completed" id="box1">
              <div class="result-box-inner"><div class="game-label">Game 1</div><div class="game-status" id="g1Status">—</div></div>
            </div>
            <div class="result-box completed" id="box2">
              <div class="result-box-inner"><div class="game-label">Game 2</div><div class="game-status" id="g2Status">—</div></div>
            </div>
            <div class="result-box current" id="box3">
              <div class="result-box-inner"><div class="game-label">Game 3</div><div class="game-status" id="g3Status">—</div></div>
            </div>
          </div>
          <br><br><br><br><br><br><br><br><br>
      <a href="results.html" class="btn final-result-btn" style="text-decoration: none;">RESULT</a>
        </div>
      </div>
      
    </div>
  </div>

  <script>
    const fallingArea = document.getElementById('fallingArea');
    const washer = document.getElementById('washer');

    const timeValue = document.getElementById('timeValue');
    const scoreValue = document.getElementById('scoreValue');
    const washerTime = document.getElementById('washerTime');
    const washerScore = document.getElementById('washerScore');
    const missValue = document.getElementById('missValue');
    const startOverlay = document.getElementById('startOverlay');
    const gameOverOverlay = document.getElementById('gameOverOverlay');
    const startBtn = document.getElementById('startBtn');
    const videoOverlay = document.getElementById('videoOverlay');
    const introVideo = document.getElementById('game3IntroVideo');
    const resultVideoOverlay = document.getElementById('resultVideoOverlay');
    const resultVideo = document.getElementById('game3ResultVideo');

    const CLOTH_IMAGES = [
      'images/01 D.png',
      'images/02 D.png',
      'images/03 D.png',
      'images/04 D.png',
      'images/05 D.png',
      'images/06 D.png',
      'images/07 D.png',
      'images/08 D.png',
      'images/09 D.png',
      'images/10 D.png',


    ];

    const GAME_DURATION = 20; // seconds
    const SPAWN_INTERVAL = 900; // ms
    const WIN_SCORE = 20; // must catch exactly 20 items

    // Cloth fall speed settings (px per second)
    const MIN_FALL_SPEED = 600;
    const MAX_FALL_SPEED = 1200;

    let gameState = {
      running: false,
      timeLeft: GAME_DURATION,
      score: 0,
      missed: 0,
      cloths: [],
      lastTimestamp: 0,
      spawnTimer: 0,
      timerId: null,
      rafId: null
    };

    function resetState() {
      gameState.running = false;
      gameState.timeLeft = GAME_DURATION;
      gameState.score = 0;
      gameState.missed = 0;
      gameState.cloths = [];
      gameState.lastTimestamp = 0;
      gameState.spawnTimer = 0;
      if (gameState.timerId) clearInterval(gameState.timerId);
      if (gameState.rafId) cancelAnimationFrame(gameState.rafId);
      timeValue.textContent = GAME_DURATION;
      if (scoreValue) scoreValue.textContent = '0';
      if (washerTime) washerTime.textContent = GAME_DURATION;
      if (washerScore) washerScore.textContent = '0';
      if (missValue) missValue.textContent = '0';
      fallingArea.innerHTML = '';
    }

    function startActualGame() {
      resetState();
      startOverlay.classList.add('hidden');
      gameOverOverlay.classList.add('hidden');
      if (videoOverlay) {
        videoOverlay.classList.add('hidden');
      }
      if (resultVideoOverlay) {
        resultVideoOverlay.classList.add('hidden');
      }
      gameState.running = true;
      gameState.lastTimestamp = performance.now();
      gameState.timerId = setInterval(() => {
        gameState.timeLeft--;
        timeValue.textContent = gameState.timeLeft;
        if (washerTime) washerTime.textContent = gameState.timeLeft;
        if (gameState.timeLeft <= 0) {
          endGame();
        }
      }, 1000);
      gameLoop(gameState.lastTimestamp);
    }

    // Wrapper: play intro video once after instructions, then start game
    function startGame() {
      if (!introVideo || !videoOverlay) {
        startActualGame();
        return;
      }

      // Hide instruction overlay, show video overlay
      startOverlay.classList.add('hidden');
      videoOverlay.classList.remove('hidden');

      introVideo.currentTime = 0;

      introVideo.onended = function () {
        videoOverlay.classList.add('hidden');
        startActualGame();
      };

      const playPromise = introVideo.play();
      if (playPromise && typeof playPromise.then === 'function') {
        playPromise.catch(function () {
          videoOverlay.classList.add('hidden');
          startActualGame();
        });
      }
    }

    function endGame() {
      if (!gameState.running) return;
      gameState.running = false;
      if (gameState.timerId) clearInterval(gameState.timerId);
      if (gameState.rafId) cancelAnimationFrame(gameState.rafId);

      let isWin = false;
      if (gameState.score === WIN_SCORE) {
        isWin = true;
      } else {
        isWin = false;
      }
      // If player exceeds 20 items, fail immediately
      if (gameState.score > WIN_SCORE) {
        isWin = false;
      }
      localStorage.setItem('game3Result', isWin ? 'win' : 'fail');

      // Update Game 1 box
      const storedGame1 = localStorage.getItem('game1Result');
      const box1 = document.getElementById('box1');
      const g1Status = document.getElementById('g1Status');
      if (storedGame1 === 'win') {
        g1Status.textContent = '✅ WIN';
        box1.classList.add('win');
      } else if (storedGame1 === 'fail') {
        g1Status.textContent = '❌ FAIL';
        box1.classList.add('fail');
      }

      // Update Game 2 box
      const storedGame2 = localStorage.getItem('game2Result');
      const box2 = document.getElementById('box2');
      const g2Status = document.getElementById('g2Status');
      if (storedGame2 === 'win') {
        g2Status.textContent = '✅ WIN';
        box2.classList.add('win');
      } else if (storedGame2 === 'fail') {
        g2Status.textContent = '❌ FAIL';
        box2.classList.add('fail');
      }

      // Update Game 3 box (current)
      const box3 = document.getElementById('box3');
      const g3Status = document.getElementById('g3Status');
      if (isWin) {
        g3Status.textContent = '✅ WIN';
        box3.classList.remove('current');
        box3.classList.add('win');
      } else {
        g3Status.textContent = '❌ FAIL';
        box3.classList.remove('current');
        box3.classList.add('fail');
      }
      const showOverlay = () => {
        gameOverOverlay.classList.remove('hidden');
      };

      if (resultVideoOverlay && resultVideo) {
        playGame3ResultVideo(isWin, showOverlay);
      } else {
        showOverlay();
      }
    }

    function playGame3ResultVideo(isWin, onComplete) {
      if (!resultVideoOverlay || !resultVideo) {
        if (typeof onComplete === 'function') onComplete();
        return;
      }

      // Use separate win/lose videos for Game 3
      const src = isWin ? 'videos/03 Game - win.mp4' : 'videos/03 Game - loss.mp4';

      resultVideo.src = src;
      resultVideo.currentTime = 0;

      resultVideoOverlay.classList.remove('hidden');

      resultVideo.onended = function () {
        resultVideoOverlay.classList.add('hidden');
        if (typeof onComplete === 'function') onComplete();
      };

      const playPromise = resultVideo.play();
      if (playPromise && typeof playPromise.then === 'function') {
        playPromise.catch(function () {
          resultVideoOverlay.classList.add('hidden');
          if (typeof onComplete === 'function') onComplete();
        });
      }
    }

    function spawnCloth() {
      const areaRect = fallingArea.getBoundingClientRect();
      const imgSrc = CLOTH_IMAGES[Math.floor(Math.random() * CLOTH_IMAGES.length)];

      const el = document.createElement('div');
      el.className = 'cloth';
      const img = document.createElement('img');
      img.src = imgSrc;
      img.alt = 'Cloth';
      el.appendChild(img);

      const x = Math.random() * (areaRect.width - 70);
      const y = -80;
      el.style.transform = `translate(${x}px, ${y}px)`;

      fallingArea.appendChild(el);

      // Random fall speed between MIN_FALL_SPEED and MAX_FALL_SPEED
      const speed = MIN_FALL_SPEED + Math.random() * (MAX_FALL_SPEED - MIN_FALL_SPEED);
      gameState.cloths.push({ el, x, y, speed });
    }

    function updatePositions(dt) {
      const areaRect = fallingArea.getBoundingClientRect();
      const washerRect = washer.getBoundingClientRect();

      const remaining = [];

      for (const cloth of gameState.cloths) {
        cloth.y += cloth.speed * dt;
        cloth.el.style.transform = `translate(${cloth.x}px, ${cloth.y}px)`;

        const clothRect = cloth.el.getBoundingClientRect();

        const overlap = !(
          clothRect.right < washerRect.left + 10 ||
          clothRect.left > washerRect.right - 10 ||
          clothRect.bottom < washerRect.top + 10 ||
          clothRect.top > washerRect.bottom - 10
        );

        if (overlap) {
          gameState.score++;
          if (scoreValue) scoreValue.textContent = gameState.score;
          if (washerScore) washerScore.textContent = gameState.score;
          cloth.el.remove();
          // If player exceeds 20 items, fail immediately
          if (gameState.score > WIN_SCORE) {
            endGame();
            return;
          }
          continue;
        }

        if (cloth.y > areaRect.height) {
          gameState.missed++;
          if (missValue) missValue.textContent = gameState.missed;
          cloth.el.remove();
          continue;
        }

        remaining.push(cloth);
      }

      gameState.cloths = remaining;
    }

    function gameLoop(timestamp) {
      if (!gameState.running) return;
      const dt = (timestamp - gameState.lastTimestamp) / 1000;
      gameState.lastTimestamp = timestamp;

      gameState.spawnTimer += dt * 1000;
      if (gameState.spawnTimer >= SPAWN_INTERVAL) {
        gameState.spawnTimer -= SPAWN_INTERVAL;
        spawnCloth();
      }

      updatePositions(dt);
      gameState.rafId = requestAnimationFrame(gameLoop);
    }

    function moveWasher(deltaX) {
      const wrapperRect = document.querySelector('.game-wrapper').getBoundingClientRect();
      const washerRect = washer.getBoundingClientRect();
      const currentCenter = washerRect.left + washerRect.width / 2;
      let newCenter = currentCenter + deltaX;

      const minX = wrapperRect.left + washerRect.width / 2;
      const maxX = wrapperRect.right - washerRect.width / 2;
      if (newCenter < minX) newCenter = minX;
      if (newCenter > maxX) newCenter = maxX;

      const offset = newCenter - wrapperRect.left - washerRect.width / 2;
      washer.style.left = `${offset}px`;
      washer.style.transform = 'none';
    }

    window.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') {
        moveWasher(-40);
      } else if (e.key === 'ArrowRight') {
        moveWasher(40);
      }
    });

    let dragging = false;
    let dragStartX = 0;
    let washerStartLeft = 0;

    function onPointerDown(e) {
      dragging = true;
      washer.style.cursor = 'grabbing';
      dragStartX = e.clientX;
      const rect = washer.getBoundingClientRect();
      washerStartLeft = rect.left;
      window.addEventListener('pointermove', onPointerMove);
      window.addEventListener('pointerup', onPointerUp);
    }

    function onPointerMove(e) {
      if (!dragging) return;
      const dx = e.clientX - dragStartX;
      const wrapperRect = document.querySelector('.game-wrapper').getBoundingClientRect();
      const washerRect = washer.getBoundingClientRect();
      let newLeft = washerStartLeft + dx;

      const minLeft = wrapperRect.left;
      const maxLeft = wrapperRect.right - washerRect.width;
      if (newLeft < minLeft) newLeft = minLeft;
      if (newLeft > maxLeft) newLeft = maxLeft;

      const offset = newLeft - wrapperRect.left;
      washer.style.left = `${offset}px`;
      washer.style.transform = 'none';
    }

    function onPointerUp() {
      dragging = false;
      washer.style.cursor = 'grab';
      window.removeEventListener('pointermove', onPointerMove);
      window.removeEventListener('pointerup', onPointerUp);
    }

    washer.addEventListener('pointerdown', onPointerDown);
    startBtn.addEventListener('click', startGame);
  </script>
</body>
</html>
