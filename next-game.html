<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weight Collector - 3kg Challenge</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Gill Sans MT';
        }

        body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
            font-family: 'Gill Sans MT';
        }

        .game-wrapper {
            position: relative;
            width: 100vw;
            height: 100vh;
            max-width: 1080px;
            max-height: 1920px;
            margin: 0 auto;
            overflow: hidden;
            aspect-ratio: 9 / 16;
            background:url("New folder (8)/Game Empty 02.png");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .timer-panel {
            position: absolute;
            top: 130px;
            left: 28%;
            transform: translateX(-50%);
            padding: 16px 36px;
            border-radius: 40px;
            /* background: rgba(0, 0, 0, 0.72); */
            /* border: 2px solid rgba(78, 205, 196, 0.5); */
            color: rgba(22, 56, 104, 0.9);
            font-size: 8.2rem;
            font-weight: bold;
            letter-spacing: 2px;
            z-index: 120;
            pointer-events: none; /* don't block clicks on items behind */
        }

        .timer-label {
            color: #a0a0a0;
            font-size: 1rem;
            display: block;
            margin-bottom: 6px;
            letter-spacing: 2px; /* keep at 2 to match global spacing */
        }

        .weight-display {
            position: absolute;
            top: -960px;
            left: 68%;
            transform: translateX(-50%);
            padding: 12px 36px;
            border-radius: 30px;
            /* background: rgba(0, 0, 0, 0.78); */
            /* border: 2px solid rgba(245, 242, 236, 0.6); */
            color: #f9f8f5;
            font-size: 5.4rem;
            font-weight: bold;
            letter-spacing: 2px;
            text-align: center;
            white-space: nowrap; /* keep text on one line */
            z-index: 210;
            pointer-events: none; /* purely display, allow clicks through */
        }

        /* Game area for items */
        .game-area {
            position: absolute;
            top: 120px;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
        }

        /* Collectible items (PNG images) */
        .item {
            position: absolute;
            cursor: pointer;
            transition: transform 0.2s ease, opacity 0.2s ease;
            user-select: none;
            animation: float 3s ease-in-out infinite;
            width: 210px;
            height: 210px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 250; /* ensure items stay on top and are clickable */
        }

        .item img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            pointer-events: none;
        }

        .item:hover {
            transform: scale(1.1);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Weight label on items */
        .item-weight {
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            /* background: rgba(0, 0, 0, 0.8); */
            color: #ffffff;
            padding: 6px 14px;
            border-radius: 12px;
            font-size: 3rem;
            font-weight: bold;
            white-space: nowrap;
            pointer-events: none;
        }

        /* Floating score popup (near bucket) */
        .score-popup {
            position: fixed;
            color: #00ff88;
            font-size: 4.2rem;
            font-weight: bold;
            pointer-events: none;
            animation: scoreFloat 1s ease-out forwards;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
            z-index: 900;
        }

        @keyframes scoreFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-50px) scale(1.3);
            }
        }

        /* Bucket at bottom center */
        .bucket {
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 800px;
            height: 800px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            z-index: 200;
            pointer-events: none; /* bucket is not clickable */
        }

        .bucket img {
            width: 100%;
            height: auto;
            filter: drop-shadow(0 0 15px rgba(0,0,0,0.7));
        }

        /* .bucket-count {
            margin-top: 8px;
            padding: 8px 16px;
            border-radius: 16px;
            background: rgba(0, 0, 0, 0.8);
            color: #4ecdc4;
            font-size: 1.4rem;
            font-weight: bold;
        } */

        /* Game Over Overlay */
        .game-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(22, 56, 104, 0.9);
            background-image: url("New folder (8)/new.png");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            display: none;
            justify-content: flex-start;
            align-items: center;
            z-index: 1000;
            flex-direction: column;
        }

        /* Glassmorphic popup for game-overlay */
        .game-overlay .glass-popup {
            position: absolute;
            top: 36%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 900px;
            height: 1200px;
            background: rgba(30, 30, 40, 0.55);
            border-radius: 48px;
            box-shadow: 0 8px 40px rgba(0,0,0,0.35);
            backdrop-filter: blur(18px) saturate(140%);
            border: 2px solid rgba(255,255,255,0.18);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 20;
        }

        .game-overlay.show {
            display: flex;
        }

          .overlay-content {
              text-align: center;
              padding: 20px 20px 10px;
              margin: 100px auto 0;
              max-width: 720px;
              width: 100%;
              box-sizing: border-box;
          }

        .overlay-title {
            font-size: 5rem;
            margin-bottom: 20px;
            text-shadow: 0 0 30px color( blue);
            color: hsl(0, 0%, 100%);
        }

        .overlay-title.win {
            color: #00ff88;
        }

        .overlay-title.lose {
            color: #ff4444;
        }

        .overlay-score {
            color: #fff;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .overlay-detail {
            color: #a0a0a0;
            font-size: 1.1rem;
            margin-bottom: 30px;
        }

        /* Intro video overlay (Game 2) */
        .video-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1100;
        }

        .video-overlay.show {
            display: flex;
        }

        .video-overlay video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Previous game result */
        .prev-result {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 25px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .prev-result-title {
            color: #a0a0a0;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .prev-result-value {
            color: #e94560;
            font-size: 1.3rem;
            font-weight: bold;
        }

        /* Buttons - unified style (same as instructionScreen .btn in game.html) */
        .btn {
            font-size: 3.5rem;
            padding: 23px 70px;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-decoration: none;
            display: inline-block;
            margin: 30px;
            background: linear-gradient(135deg,  #ffffff);
            color: rgb(22, 56, 104);
            font-family: "Gill Sans MT";
        }

        .btn-next {
            /* Keep base .btn look; just add spacing below if needed */
            margin-bottom: 86px;
        }

        .btn-next:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 35px rgba(78, 205, 196, 0.6);
        }

        /* Start overlay */
        .start-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            /* Blue tint + background image */
            background-color: rgb(22, 56, 104);
            background-image: url("New folder (8)/new.png");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            display: flex;
            /* Match Game 1 instruction placement: top & middle */
            justify-content: flex-start; /* top vertically (column main axis) */
            /* align-items: center;       center horizontally */
            padding-top: 650px;
            z-index: 1000;
            flex-direction: column;
            
        }

        /* Glassmorphic popup for start-overlay */
        .start-overlay .glass-popup {
            position: absolute;
            top: 36%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 900px;
            height: 1200px;
            background: rgba(30, 30, 40, 0.55);
            border-radius: 48px;
            box-shadow: 0 8px 40px rgba(0,0,0,0.35);
            backdrop-filter: blur(18px) saturate(140%);
            border: 2px solid rgba(255,255,255,0.18);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 20;
        }

        .start-overlay.hidden {
            display: none;
            
        }

        .start-title {
            color: #ffffff;
            font-size: 7rem;
            margin-bottom: 60px;
            text-transform: uppercase;
            
        }

        .start-instructions {
            color: #ffffff;
            font-size: 3.2em;
            margin-bottom: 10px;
            text-align: center;
            max-width: 900px;
            font-family: 'Gill Sans MT';
        }

        .start-instructions.justify-text {
            text-align: justify;
        }

        .start-target {
            color: #00ff88;
            font-size: 2rem;
            font-weight: bold;
            margin: 30px 0;
        }

        .btn-start {
            /* Uses base .btn style; just adjust top margin */
            margin-top: 80px;
              border-radius: 80px;
        }

        /* Results summary */
        .results-summary {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 50px;
            padding: 20px 30px;
            margin-top: 60px;
        }

        .results-title {
            color: #ffaa00;
            font-size: 1.3rem;
            margin-bottom: 10px;
            display: inline-block;
            vertical-align: middle;
            margin-right: 10px;
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .result-row:last-child {
            border-bottom: none;
        }

        .result-game {
            color: #a0a0a0;
        }

        .result-status {
            font-weight: bold;
            display: inline-block;
            vertical-align: middle;
            font-size: 1.3rem;
        }

        .result-status.win {
            color: #00ff88;
        }

        .result-status.lose {
            color: #ff4444;
        }

        /* 3-box Results UI */
        .result-boxes {
             display: flex;
            flex-direction: column;
            gap: 94px;
            width: 100%;
            max-width: 720px;
            margin: 0 auto 10px;
            height: 500px;
        }

        .result-box {
            border: 3px solid #333;
            border-radius: 80px;
            padding: 4px 10px;
            text-align: center;
            font-size: 1.5rem;
            color: #888;
            background: rgba(0,0,0,0.3);
            min-height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .result-box.current {
            border: 4px dashed #4ecdc4;
            background: rgba(78, 205, 196, 0.1);
            color: #fff;
        }

        .result-box.completed {
            border: 4px solid #555;
        }

        .result-box.win {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.15);
            color: #fff;
        }

        .result-box.lose {
            border-color: #ff4444;
            background: rgba(255, 68, 68, 0.15);
            color: #fff;
        }

        .result-box .game-label {
            font-size: 3.4rem;
            color: #aaa;
            margin-bottom: 0;
            display: inline-block;
            vertical-align: middle;
            margin-right: 18px;
        }

        .result-box .game-status {
            font-size: 4.4rem;
            font-weight: bold;
        }

        .game-overlay .btn-next {
            margin-top: 80px;
              border-radius: 80px;
        }
    </style>
</head>
<body>
    <div class="game-wrapper">
    <!-- Start Overlay -->
    <div class="start-overlay" id="startOverlay">
        <div class="glass-popup">
            <div class="start-title">HOW TO PLAY</div>
            <br><br>
            <p class="start-instructions ">1.Tap to collect clothes that total a<br> weight of 3kg</p>
            <p class="start-instructions">2.Each cloth has a random weight<br> between 100g & 500g</p>
            <p class="start-instructions">3.Collect your 3kg washload within 20 seconds</p>
            <!-- <div class="start-target"> Collect 3000g (3kg) or more in 20 seconds</div> -->
            <!-- <div class="prev-result" id="prevResult" style="display: none;">
                <div class="prev-result-title">Game 1 Result (Pour Perfect)</div>
                <div class="prev-result-value" id="prevResultValue">-</div>
            </div> -->
            <button class="btn btn-start" onclick="startGame()">Start Game</button>
        </div>
    </div>

    <!-- Game 2 Intro Video Overlay -->
    <div class="video-overlay" id="videoOverlay">
        <video id="game2IntroVideo" playsinline webkit-playsinline>
            <source src="videos/02_game_pop.mp4" type="video/mp4">
        </video>
    </div>

    <!-- Game 2 Result Video Overlay (Win/Lose) -->
    <div class="video-overlay" id="resultVideoOverlay">
        <video id="game2ResultVideo" playsinline webkit-playsinline></video>
    </div>

    <!-- Timer Display -->
    <div class="timer-panel">
        <!-- <span class="timer-label">TIME</span> -->
        <span id="timerDisplay">20</span>
    </div>

    <!-- Game Area -->
    <div class="game-area" id="gameArea"></div>

    <!-- Bucket -->
    <div class="bucket" id="bucket">
        <div class="weight-display"><span id="scoreDisplay">0g</span></div>
        <img id="bucketImage" src="Basket/1.png" alt="Bucket">
        <div class="bucket-count">Items: <span id="bucketItemCount">0</span></div>
    </div>

    <!-- Game Over Overlay -->
    <div class="game-overlay" id="gameOverlay">
        <div class="glass-popup">
            <div class="overlay-content">
                <div class="overlay-title" id="overlayTitle">GAME RESULTS</div>
                <br> <br><br><br>
                <div class="result-boxes">
                    <div class="result-box completed" id="box1">
                        <div class="game-label">Game 1</div>
                        <div class="game-status" id="g1Status">—</div>
                    </div>
                    <div class="result-box current" id="box2">
                        <div class="game-label">Game 2</div>
                        <div class="game-status" id="g2Status">—</div>
                    </div>
                    <div class="result-box" id="box3">
                        <div class="game-label">Game 3</div>
                        <div class="game-status">Pending</div>
                    </div>
                </div>
                <a href="game3.html" class="btn btn-next">Next</a>
            </div>
        </div>
    </div>

    <script>
        // PNG item images (replace with your actual file names)
        const ITEM_TYPES = [
            { src: 'item1.png' },
            { src: 'item2.png' },
            { src: 'item3.png' },
            { src: 'item4.png' },
            { src: 'item5.png' },
            { src: 'item6.png' },
            { src: 'item7.png' },
            { src: 'item8.png' },
            { src: 'item9.png' },
            { src: 'item10.png' }
            
        ];

        // Possible weights in grams
        const WEIGHTS = [100, 250, 200, 300, 350, 450, 400, 50, 500];

        // Game state
        let gameState = {
            totalWeight: 0,
            targetWeight: 3000,
            timeLimit: 20,
            isPlaying: false,
            items: [],
            spawnInterval: null,
            itemsCollected: 0
        };

        // DOM elements
        const gameArea = document.getElementById('gameArea');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const weightDisplay = scoreDisplay.parentElement;
        const gameOverlay = document.getElementById('gameOverlay');
        const overlayTitle = document.getElementById('overlayTitle');
        const startOverlay = document.getElementById('startOverlay');
        const bucket = document.getElementById('bucket');
        const bucketItemCount = document.getElementById('bucketItemCount');
        const videoOverlay = document.getElementById('videoOverlay');
        const introVideo = document.getElementById('game2IntroVideo');
        const resultVideoOverlay = document.getElementById('resultVideoOverlay');
        const resultVideo = document.getElementById('game2ResultVideo');
        const timerDisplay = document.getElementById('timerDisplay');

        let timerInterval = null;
        let remainingSeconds = 20;

        function startTimer() {
            clearInterval(timerInterval);
            remainingSeconds = gameState.timeLimit;
            // Show plain seconds (same style as game3.html)
            timerDisplay.textContent = remainingSeconds;
            timerInterval = setInterval(() => {
                remainingSeconds -= 1;
                timerDisplay.textContent = remainingSeconds;
                
                // Time's up - player loses
                if (remainingSeconds <= 0) {
                    endGame(true); // true = time ran out
                }
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
        }

        // Load previous game result (from first video game)
        function loadPreviousResult() {
            let stored = localStorage.getItem('game1Result'); // 'win' or 'lose'
            if (stored === 'fail') stored = 'lose';
            if (stored) {
                const isWin = stored === 'win';
                document.getElementById('prevResult').style.display = 'block';
                document.getElementById('prevResultValue').textContent = isWin ? '✅ WIN' : '❌ LOSE';
            }
        }

        // Create a single item
        // function createItem() {
        //     const item = document.createElement('div');
        //     const type = ITEM_TYPES[Math.floor(Math.random() * ITEM_TYPES.length)];
        //     const weight = WEIGHTS[Math.floor(Math.random() * WEIGHTS.length)];
            
        //     item.className = 'item';
        //     item.innerHTML = `
        //         <img src="${type.src}" alt="Item">
        //         <span class="item-weight">${weight}g</span>
        //     `;
            
        //     // Random position - avoid bucket area at bottom center
        //     const maxX = window.innerWidth - 120;
        //     const maxY = window.innerHeight - 500; // leave room for bucket (800px height)
        //     const x = Math.random() * maxX;
        //     const y = Math.random() * maxY;
            
        //     item.style.left = `${x}px`;
        //     item.style.top = `${y}px`;
        //     item.style.animationDelay = `${Math.random() * 2}s`;
            
        //     item.dataset.weight = weight;
            
        //     item.addEventListener('click', () => collectItem(item, weight));
            
        //     gameArea.appendChild(item);
        //     gameState.items.push(item);
        // }

        function createItem() {
    const item = document.createElement('div');
    const type = ITEM_TYPES[Math.floor(Math.random() * ITEM_TYPES.length)];
    const weight = WEIGHTS[Math.floor(Math.random() * WEIGHTS.length)];

    item.className = 'item';
    item.innerHTML = `
        <img src="${type.src}" alt="Item">
        <span class="item-weight">${weight}g</span>
    `;

    const maxX = window.innerWidth - 180;
    const x = Math.random() * maxX;

    // ✅ CONTROLLED Y RANGE
    const bucketRect = bucket.getBoundingClientRect();
    const spawnTop = 120;
    const spawnBottom = bucketRect.top - 80;

    const y = Math.random() * (spawnBottom - spawnTop) + spawnTop;

    item.style.left = `${x}px`;
    item.style.top = `${y}px`;

    item.dataset.weight = weight;
    item.addEventListener('click', () => collectItem(item, weight));

    gameArea.appendChild(item);
    gameState.items.push(item);
}


        // Spawn items continuously
        function spawnItems() {
            // Initial items
            for (let i = 0; i < 6; i++) {
                createItem();
            }
            
            // Spawn new items periodically
            gameState.spawnInterval = setInterval(() => {
                if (gameState.isPlaying && gameState.items.length < 20) {
                    createItem();
                }
            }, 1500);
        }

        // Animate item into the bucket (with reliable timeout)
        function animateToBucket(item, weight, callback) {
            const itemRect = item.getBoundingClientRect();
            const bucketRect = bucket.getBoundingClientRect();

            const itemCenterX = itemRect.left + itemRect.width / 2;
            const itemCenterY = itemRect.top + itemRect.height / 2;
            const bucketCenterX = bucketRect.left + bucketRect.width / 2;
            const bucketCenterY = bucketRect.top + bucketRect.height / 2;

            const translateX = bucketCenterX - itemCenterX;
            const translateY = bucketCenterY - itemCenterY;

            // Stop float animation and animate towards bucket
            item.style.animation = 'none';
            item.style.transition = 'transform 0.6s ease-in, opacity 0.6s ease-in';
            // Force reflow so transition always applies
            void item.offsetWidth;
            item.style.transform = `translate(${translateX}px, ${translateY}px) scale(0.2)`;
            item.style.opacity = '0';
            item.style.pointerEvents = 'none';

            setTimeout(() => {
                item.remove();
                if (typeof callback === 'function') callback();
                showScorePopup(weight);
            }, 600);
        }

        // Collect an item
        function collectItem(item, weight) {
            if (!gameState.isPlaying) return;

            // Prevent double clicks
            item.style.pointerEvents = 'none';

            animateToBucket(item, weight, () => {
                gameState.totalWeight += weight;
                gameState.itemsCollected += 1;
                const bucketCount = document.getElementById('bucketItemCount');
                if (bucketCount) bucketCount.textContent = gameState.itemsCollected;

                // Remove from tracking
                const index = gameState.items.indexOf(item);
                if (index > -1) {
                    gameState.items.splice(index, 1);
                }

                updateDisplay();

                // Check win/lose condition
                if (gameState.totalWeight >= gameState.targetWeight) {
                    endGame(false); // false = time didn't run out
                }
            });
        }

        // Show floating score popup near bucket
        function showScorePopup(weight) {
            const popup = document.createElement('div');
            popup.className = 'score-popup';
            popup.textContent = `+${weight}g`;

            const bucketRect = bucket.getBoundingClientRect();
            popup.style.left = `${bucketRect.left + bucketRect.width / 2}px`;
            popup.style.top = `${bucketRect.top - 10}px`;

            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 1000);
        }

        // Update bucket image based on weight level
        function updateBucketImage() {
            const bucketImage = document.getElementById('bucketImage');
            const weight = gameState.totalWeight;
            const target = gameState.targetWeight;
            
            // Calculate fill level (1-4) based on weight progress
            let fillLevel;
            if (weight <= target * 0.25) {
                fillLevel = 1;  // 0-250g
            } else if (weight <= target * 0.5) {
                fillLevel = 2;  // 251-500g
            } else if (weight <= target * 0.75) {
                fillLevel = 3;  // 501-750g
            } else {
                fillLevel = 4;  // 751-1000g+
            }
            
            bucketImage.src = `Basket/${fillLevel}.png`;
        }

        // Format weight in g or Kg + g (e.g. 1100g -> 1Kg 100g)
        function formatTotalWeight(totalGrams) {
            if (totalGrams < 1000) {
                return `${totalGrams}g`;
            }
            const kg = Math.floor(totalGrams / 1000);
            const g = totalGrams % 1000;
            if (g === 0) {
                return `${kg}Kg`;
            }
            return `${kg}Kg ${g}g`;
        }

        // Auto-adjust font size so weight text fits on one line
        function adjustWeightFont() {
            if (!weightDisplay) return;
            // Max and min font sizes in rem
            const maxSize = 6;
            const minSize = 3;
            let size = maxSize;
            weightDisplay.style.fontSize = `${size}rem`;

            // Reduce font size until text fits within container or reach min
            while (size > minSize && weightDisplay.scrollWidth > weightDisplay.clientWidth) {
                size -= 0.3;
                weightDisplay.style.fontSize = `${size}rem`;
            }
        }

        // Update display
        function updateDisplay() {
            scoreDisplay.textContent = formatTotalWeight(gameState.totalWeight);
            updateBucketImage();
            adjustWeightFont();
        }

        // Start the game (internal, after intro video)
        function startActualGame() {
            startOverlay.classList.add('hidden');
            if (videoOverlay) {
                videoOverlay.classList.remove('show');
            }
            if (resultVideoOverlay) {
                resultVideoOverlay.classList.remove('show');
            }
            gameState.isPlaying = true;
            gameState.totalWeight = 0;
            gameState.items = [];
            gameState.itemsCollected = 0;
            const bucketCount = document.getElementById('bucketItemCount');
            if (bucketCount) bucketCount.textContent = '0';
            
            // Reset bucket image to empty state
            document.getElementById('bucketImage').src = 'Basket/1.png';
            
            gameArea.innerHTML = '';
            updateDisplay();
            startTimer();
            spawnItems();
        }

        // Wrapper called from the Start button: play intro video, then start game
        function startGame() {
            // If no intro video element, just start immediately
            if (!introVideo || !videoOverlay) {
                startActualGame();
                return;
            }

            startOverlay.classList.add('hidden');

            // Show overlay and play intro video
            videoOverlay.classList.add('show');
            introVideo.currentTime = 0;

            // When video finishes, start the actual game
            introVideo.onended = function () {
                videoOverlay.classList.remove('show');
                startActualGame();
            };

            // Try to play; if it fails (autoplay issues), start game anyway
            const playPromise = introVideo.play();
            if (playPromise && typeof playPromise.then === 'function') {
                playPromise.catch(function () {
                    videoOverlay.classList.remove('show');
                    startActualGame();
                });
            }
        }

        // End the game
        function endGame(timeOut = false) {
            gameState.isPlaying = false;
            clearInterval(gameState.spawnInterval);
            stopTimer();
            
            // Win if target reached or exceeded AND time didn't run out
            const isWin = !timeOut && gameState.totalWeight >= gameState.targetWeight;
            
            // Save result for this game
            localStorage.setItem('game2Result', isWin ? 'win' : 'fail');
            
            // Update Game 1 box
            const storedGame1 = localStorage.getItem('game1Result');
            const box1 = document.getElementById('box1');
            const g1Status = document.getElementById('g1Status');
            if (storedGame1 === 'win') {
                g1Status.textContent = '✅ WIN';
                box1.classList.add('win');
            } else if (storedGame1 === 'fail' || storedGame1 === 'lose') {
                g1Status.textContent = '❌ LOSE';
                box1.classList.add('lose');
            }
            
            // Update Game 2 box (current)
            const box2 = document.getElementById('box2');
            const g2Status = document.getElementById('g2Status');
            if (isWin) {
                g2Status.textContent = '✅ WIN';
                box2.classList.remove('current');
                box2.classList.add('win');
            } else {
                g2Status.textContent = '❌ FAIL';
                box2.classList.remove('current');
                box2.classList.add('fail');
            }
            
            const showOverlay = () => {
                gameOverlay.classList.add('show');
            };

            if (resultVideoOverlay && resultVideo) {
                playResultVideo(isWin, showOverlay);
            } else {
                setTimeout(showOverlay, 500);
            }
        }

        function playResultVideo(isWin, onComplete) {
            if (!resultVideoOverlay || !resultVideo) {
                if (typeof onComplete === 'function') onComplete();
                return;
            }

            // Use separate win/lose videos for Game 2
            const src = isWin ? 'videos/02 Game - win.mp4' : 'videos/02 Game - fail.mp4';

            resultVideo.src = src;
            resultVideo.currentTime = 0;

            resultVideoOverlay.classList.add('show');

            resultVideo.onended = function () {
                resultVideoOverlay.classList.remove('show');
                if (typeof onComplete === 'function') onComplete();
            };

            const playPromise = resultVideo.play();
            if (playPromise && typeof playPromise.then === 'function') {
                playPromise.catch(function () {
                    resultVideoOverlay.classList.remove('show');
                    if (typeof onComplete === 'function') onComplete();
                });
            }
        }

        // Restart game (skip intro video)
        function restartGame() {
            gameOverlay.classList.remove('show');
            stopTimer();
            
            setTimeout(() => {
                startActualGame();
            }, 300);
        }

        // Initialize
        loadPreviousResult();
    </script>
</body>
</html>
